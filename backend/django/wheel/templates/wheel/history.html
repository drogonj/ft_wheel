<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- wheel.png Designed by Freepik -->
    <link rel="shortcut icon" type="image/png" href="{% static 'images/wheel.png' %}">
    <link rel="stylesheet" href="{% static 'css/global.css' %}" />
    <link rel="stylesheet" href="{% static 'css/history.css' %}" />
    <link rel="stylesheet" href="{% static 'css/logout.css' %}" />
    <link rel="stylesheet" href="{% static 'css/menu.css' %}" />
    <title>ft_wheel</title>
</head>
<body>

    {% include 'wheel/menu.html' %}

    <div class="history-buttons">
        <button id="show-global-history" class="history-button history-selected">Global history</button>
        <button id="show-my-history" class="history-button">My history</button>
    </div>

    <div class="history-container" id="global-history" style="display: flex;">
        {% if all_history %}
            {% for entry in all_history %}
                <div class="history-entry" id="entry-{{ entry.id }}" data-color="{{ entry.color }}">
                    <p id="date"><strong>Date:</strong> <span class="timestamp" data-utc="{{ entry.timestamp|date:'c' }}">{{ entry.timestamp }}</span></p>
                    <a class="history-user-p" href="https://profile.intra.42.fr/users/{{ entry.user.login }}"><strong>{{ entry.user.login }}</strong></a>
                    <p id="gain"><strong>Reward:</strong> {{ entry.details|upper }}</p>
                </div>
            {% endfor %}
        {% else %}
                <p class="nohistory">No history entries found.</p>
        {% endif %}
    </div>

    <div class="history-container" id="my-history" style="display: none;">
        {% if my_history %}
            {% for entry in my_history %}
                <div class="history-entry" id="entry-{{ entry.id }}" data-color="{{ entry.color }}">
                    <p id="date"><strong>Date:</strong> <span class="timestamp" data-utc="{{ entry.timestamp|date:'c' }}">{{ entry.timestamp }}</span></p>
                    <p><strong>Mode:</strong> {{entry.wheel|upper }}</p>
                    <p id="gain"><strong>Reward:</strong> {{ entry.details|upper }}</p>
                </div>
            {% endfor %}
        {% else %}
                <p class="nohistory">No history entries found.</p>
        {% endif %}
    </div>

    <script>
        document.querySelectorAll('.timestamp').forEach(function(el) {
            const utc = el.dataset.utc;
            const local = new Date(utc).toLocaleString();
            el.textContent = local;
        });

        document.querySelectorAll('.history-entry').forEach(function(el) {
            const hex = el.dataset.color;
            // Convert hex to rgba with 0.2 alpha (20% opacity)
            function hexToRgba(hex, alpha) {
                let c = hex.replace('#', '');
                if (c.length === 3) c = c.split('').map(x => x + x).join('');
                const num = parseInt(c, 16);
                const r = (num >> 16) & 255;
                const g = (num >> 8) & 255;
                const b = num & 255;
                return `rgba(${r},${g},${b},${alpha})`;
            }
            el.style.background = hexToRgba(hex, 0.2);
        });   
        
        document.getElementById('show-global-history').addEventListener('click', function() {
            document.getElementById('global-history').style.display = 'flex';
            document.getElementById('my-history').style.display = 'none';
            // Enable css "selected" effect
            this.classList.add('history-selected');
            document.getElementById('show-my-history').classList.remove('history-selected');
        });
        document.getElementById('show-my-history').addEventListener('click', function() {
            document.getElementById('global-history').style.display = 'none';
            document.getElementById('my-history').style.display = 'flex';
            // Enable css "selected" effect
            this.classList.add('history-selected');
            document.getElementById('show-global-history').classList.remove('history-selected');
        });
    </script>
</body>

</html>
